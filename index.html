

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Little Confession — Anonymous Grand Wall</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Anonymous, non-commercial confession wall. No identities collected. Client-side only." />
  <style>
    :root {
      --bg: #0f1216; --panel: #161b22; --text: #e6e6e6; --muted: #9aa3ad;
      --accent: #5aa8ff; --border: #24303c; --ok: #4caf50; --warn: #ffb74d; --danger: #ff6b6b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, #0f1216, #0c1015 60%, #0a0d12);
      color: var(--text);
    }
    header {
      display: flex; align-items: center; gap: 16px; padding: 18px 22px; border-bottom: 1px solid var(--border);
      background: #0d1117; position: sticky; top: 0; z-index: 10;
    }
    .brand { font-weight: 800; letter-spacing: 0.3px; }
    .tag { color: var(--muted); font-size: 0.9rem; }
    .wrap {
      max-width: 1100px; margin: 24px auto; padding: 0 20px;
      display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 24px;
    }
    .panel {
      background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1, h2 { margin: 0 0 8px; }
    p { margin: 8px 0; }
    .muted { color: var(--muted); }
    label { display: block; margin-top: 12px; color: var(--muted); font-size: 0.95rem; }
    input, textarea, select {
      width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #2a3440;
      background: #0d1117; color: var(--text); outline: none;
    }
    input:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(90,168,255,0.25); }
    textarea { min-height: 160px; resize: vertical; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .consent { margin-top: 12px; display: flex; gap: 8px; align-items: center; color: var(--muted); }
    .btn {
      margin-top: 14px; padding: 12px 16px; border-radius: 12px; border: none; font-weight: 700;
      background: #2a3440; color: #b8c2cc; cursor: not-allowed;
    }
    .btn.enabled { background: var(--accent); color: #0b1a2b; cursor: pointer; }
    .count { margin-top: 6px; font-size: 0.85rem; }
    .count.ok { color: var(--ok); }
    .count.warn { color: var(--warn); }
    .count.danger { color: var(--danger); }
    .divider { border-top: 1px dashed var(--border); margin: 12px 0; }
    .wallHeader { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .pill {
      display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px;
      background: #0d131a; border: 1px solid var(--border); color: var(--muted); font-size: 0.85rem;
    }
    .list { display: grid; gap: 10px; margin-top: 10px; }
    .card {
      background: #0d1117; border: 1px solid var(--border); border-radius: 12px; padding: 12px;
    }
    .name { font-weight: 700; }
    .msg { white-space: pre-wrap; line-height: 1.55; margin-top: 6px; }
    .actions { display: flex; gap: 8px; margin-top: 10px; }
    .action {
      background: #0d131a; border: 1px solid var(--border); color: var(--muted);
      padding: 6px 10px; border-radius: 10px; cursor: pointer; font-size: 0.85rem;
    }
    .action:hover { border-color: var(--accent); color: var(--text); }
    footer { text-align: center; color: var(--muted); padding: 20px; }
    .svgWrap { display: grid; place-items: center; padding: 10px 0 0; }
    /* Responsive */
    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">Little Confession</div>
    <span class="tag"> </span>
  </header>

  <main class="wrap">
    <!-- Left: Compose -->
    <section class="panel" aria-label="Compose anonymous confession">
      <h1>Little Confession</h1>
      <p class="muted">Let your hidden thoughts be known! :)) </p>
      <div class="divider"></div>

      <form id="confessForm" autocomplete="off">
        <label for="recipient">Recipient name </label>
        <input id="recipient" name="recipient" type="text" maxlength="60" placeholder="e.g., Makashi" />

        <label for="message">Your confession (limit ~2000 words)</label>
        <textarea id="message" name="message" placeholder="Write your message here..."></textarea>
        <div id="wordCount" class="count">Words: 0 / 2000</div>
        <p class="muted">Tip: Keep it kind. Don’t include private details or anything that could identify you to others.</p>

        <div class="consent">
          <input type="checkbox" id="consent" />
          <label for="consent">I understand this is anonymous </label>
        </div>

        <button id="submitBtn" class="btn" type="submit" aria-disabled="true">Post to My Grand Wall</button>
      </form>

      <div class="divider"></div>
      <div class="svgWrap" aria-label="Blue lycoris radiata graphic">
        <!-- Simple stylized blue Lycoris radiata (spider lily) SVG -->
        <svg width="180" height="180" viewBox="0 0 200 200" role="img" aria-label="Blue Lycoris Radiata">
          <defs>
            <radialGradient id="petalGrad" cx="50%" cy="50%" r="60%">
              <stop offset="0%" stop-color="#8fd0ff"/>
              <stop offset="60%" stop-color="#5aa8ff"/>
              <stop offset="100%" stop-color="#2f6fd1"/>
            </radialGradient>
          </defs>
          <circle cx="100" cy="100" r="6" fill="#1e3a8a"/>
          <!-- 12 curved petals -->
          <g stroke="#1e3a8a" stroke-width="1.2" fill="url(#petalGrad)">
            <!-- Petal path functionally repeated with rotation -->
            <path d="M100,100 C110,80 130,70 140,60 C130,85 120,95 100,100 Z"/>
            <path d="M100,100 C120,90 140,90 160,90 C140,105 120,105 100,100 Z" transform="rotate(30 100 100)"/>
            <path d="M100,100 C120,110 140,130 150,140 C130,130 115,115 100,100 Z" transform="rotate(60 100 100)"/>
            <path d="M100,100 C110,120 110,140 110,160 C100,140 100,120 100,100 Z" transform="rotate(90 100 100)"/>
            <path d="M100,100 C90,120 70,140 60,150 C85,130 95,115 100,100 Z" transform="rotate(120 100 100)"/>
            <path d="M100,100 C80,120 60,120 40,120 C60,105 80,105 100,100 Z" transform="rotate(150 100 100)"/>
            <path d="M100,100 C80,90 60,70 50,60 C70,85 85,95 100,100 Z" transform="rotate(180 100 100)"/>
            <path d="M100,100 C90,80 90,60 90,40 C100,60 100,80 100,100 Z" transform="rotate(210 100 100)"/>
            <path d="M100,100 C110,80 130,60 140,50 C120,70 110,85 100,100 Z" transform="rotate(240 100 100)"/>
            <path d="M100,100 C120,90 140,80 160,70 C140,95 120,95 100,100 Z" transform="rotate(270 100 100)"/>
            <path d="M100,100 C120,110 140,130 150,140 C130,130 115,115 100,100 Z" transform="rotate(300 100 100)"/>
            <path d="M100,100 C110,120 120,140 130,160 C115,140 105,120 100,100 Z" transform="rotate(330 100 100)"/>
          </g>
          <!-- Fine stamens -->
          <g stroke="#0b1a2b" stroke-width="1">
            <line x1="100" y1="100" x2="160" y2="80"/>
            <circle cx="160" cy="80" r="2.5" fill="#8fd0ff"/>
            <line x1="100" y1="100" x2="50" y2="130"/>
            <circle cx="50" cy="130" r="2.5" fill="#8fd0ff"/>
            <line x1="100" y1="100" x2="80" y2="40"/>
            <circle cx="80" cy="40" r="2.5" fill="#8fd0ff"/>
          </g>
        </svg>
        <p class="muted" style="text-align:center;margin-top:6px;">This is Blue spider lilies. Be wary when holding them. </p>
      </div>
    </section>

    <!-- Right: Grand Wall (viewer) -->
    <section class="panel" aria-label="Grand Wall viewer">
      <div class="wallHeader">
        <div>
          <h2>Grand Wall</h2>
          <p class="muted">Anonymous confessions from everyone.</p>
        </div>
      </div>
      <div class="divider"></div>

      <div class="row">
        <div>
          <label for="filterName">Filter by recipient</label>
          <input id="filterName" type="text" placeholder="e.g., Makashi" />
        </div>
        <div>
          <label for="sortBy">Sort</label>
          <select id="sortBy">
            <option value="newest">Newest first</option>
            <option value="oldest">Oldest first</option>
            <option value="recipient">Recipient A→Z</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <!-- The "View messages" button is now handled by the Firebase listener -->
        <button id="clearAll" class="action" title="Clears only your browser’s copy">Clear my wall</button>
      </div>

      <div id="wallList" class="list" aria-live="polite"></div>

      <div class="divider"></div>
    </section>
  </main>

  <footer>
    <p> • Anonymous © Little Confession</p>
  </footer>

  <!-- Firebase SDKs - BEGIN -->
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
  <!-- Firebase Realtime Database SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-database-compat.js"></script>

  <script>
    // Your Firebase project configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY", // <<< REPLACE with your actual API key from Firebase Project Settings
      authDomain: "little-confession-39666.firebaseapp.com",
      databaseURL: "https://little-confession-39666-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "little-confession-39666",
      storageBucket: "little-confession-39666.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID", // <<< REPLACE with your actual sender ID from Firebase Project Settings
      appId: "YOUR_APP_ID" // <<< REPLACE with your actual App ID from Firebase Project Settings
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);

    // Get a reference to the Realtime Database service
    const database = firebase.database();
    const messagesRef = database.ref('messages'); // Reference to your 'messages' path in RTDB

    // Firebase SDKs - END


    // Elements
    const form = document.getElementById('confessForm');
    const recipientEl = document.getElementById('recipient');
    const messageEl = document.getElementById('message');
    const consentEl = document.getElementById('consent');
    const submitBtn = document.getElementById('submitBtn');
    const wordCountEl = document.getElementById('wordCount');

    const filterNameEl = document.getElementById('filterName');
    const sortByEl = document.getElementById('sortBy');
    const wallListEl = document.getElementById('wallList');
    const viewAllBtn = document.getElementById('viewAll'); // This button's functionality will change
    const clearAllBtn = document.getElementById('clearAll');

    // Utilities
    function countWords(text) {
      const words = text.trim().replace(/\s+/g, ' ').split(' ').filter(w => w.length > 0);
      return words.length;
    }
    function updateWordCount() {
      const n = countWords(messageEl.value);
      wordCountEl.textContent = `Words: ${n} / 2000`;
      wordCountEl.className = 'count ' + (n <= 1500 ? 'ok' : n <= 2000 ? 'warn' : 'danger');
    }
    function updateButtonState() {
      const nameOk = recipientEl.value.trim().length > 0;
      const words = countWords(messageEl.value);
      const wordsOk = words > 0 && words <= 2000;
      const ok = consentEl.checked && nameOk && wordsOk;
      if (ok) {
        submitBtn.classList.add('enabled');
        submitBtn.removeAttribute('aria-disabled');
      } else {
        submitBtn.classList.remove('enabled');
        submitBtn.setAttribute('aria-disabled', 'true');
      }
    }

    messageEl.addEventListener('input', () => { updateWordCount(); updateButtonState(); });
    recipientEl.addEventListener('input', updateButtonState);
    consentEl.addEventListener('change', updateButtonState);
    updateWordCount(); updateButtonState();

    // Removed localStorage functions: loadWall and saveWall are no longer needed.

    // Storage (now uses Firebase Realtime Database)
    let allConfessions = []; // This will hold the confessions fetched from Firebase

    // Render
    function renderWall(confessionsToRender) {
      const q = filterNameEl.value.trim().toLowerCase();
      let list = confessionsToRender.slice(); // Use the passed confessions

      // Sort
      const sortBy = sortByEl.value;
      if (sortBy === 'newest') list.sort((a, b) => b.ts - a.ts);
      if (sortBy === 'oldest') list.sort((a, b) => a.ts - b.ts);
      if (sortBy === 'recipient') list.sort((a, b) => a.recipient.localeCompare(b.recipient));

      // Filter
      if (q) list = list.filter(i => i.recipient.toLowerCase().includes(q));

      wallListEl.innerHTML = '';
      if (list.length === 0) {
        wallListEl.innerHTML = '<div class="card muted">No messages yet. Post one on the left to share it with everyone!</div>';
        return;
      }
      for (const item of list) {
        const card = document.createElement('div');
        card.className = 'card';
        const date = new Date(item.ts).toLocaleString();
        card.innerHTML = `
          <div class="name">${escapeHtml(item.recipient)}</div>
          <div class="muted" style="font-size:0.85rem;">Posted ${date}</div>
          <div class="msg">${escapeHtml(item.message)}</div>
        `;
        wallListEl.appendChild(card);
      }
    }

    // Escape to prevent HTML injection (still anonymous, but keep it safe)
    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[s]));
    }

    // Submit function updated to use Firebase Realtime Database
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!consentEl.checked) { alert('Please confirm consent.'); return; }
      const recipient = recipientEl.value.trim();
      const message = messageEl.value.trim();
      const words = countWords(message);
      if (!recipient || words === 0 || words > 2000) {
        alert('Please provide a recipient and a message within 2000 words.');
        return;
      }

      const newConfession = { recipient, message, ts: Date.now() };

      try {
        await messagesRef.push(newConfession); // Pushes data to Firebase
        // Clear inputs after successful push
        recipientEl.value = '';
        messageEl.value = '';
        consentEl.checked = false;
        updateWordCount();
        updateButtonState();
        alert('Confession posted anonymously to the Grand Wall!');
      } catch (error) {
        console.error("Error writing new confession to Firebase: ", error);
        alert('Failed to post confession. Please try again.');
      }
    });

    // Viewer controls updated for Firebase Realtime Database
    // The viewAllBtn is no longer strictly necessary as data loads automatically.
    // We'll keep the event listeners for filter and sort, and trigger a re-render.
    filterNameEl.addEventListener('input', () => renderWall(allConfessions));
    sortByEl.addEventListener('change', () => renderWall(allConfessions));

    // Clear All button - now only clears local display, not the Firebase database.
    // To clear the database, you'd need authenticated admin access and different rules.
    clearAllBtn.addEventListener('click', () => {
      alert('This button was for clearing local storage. Since confessions are now public on Firebase, it no longer has a function to clear the "wall" for everyone. To remove a confession, you would need to implement an authenticated deletion feature.');
    });


    // --- Firebase Realtime Database Listener ---
    // This listens for changes in your 'messages' path and updates the UI
    messagesRef.on('value', (snapshot) => {
      const data = snapshot.val();
      const loadedConfessions = [];
      for (let key in data) {
        loadedConfessions.push({
          id: key, // Firebase unique key
          ...data[key] // The confession data
        });
      }
      allConfessions = loadedConfessions; // Store the fetched confessions
      renderWall(allConfessions); // Re-render the wall with all confessions
    });

    // Initial render is now handled by the Firebase listener,
    // so `renderWall()` call here would be redundant.
  </script>
</body>
</html>
